<?xml version="1.0" encoding="UTF-8"?>
<project name="uml2cs-instantmessenger-model" default="all">
	<property name="project.path" value="/${ant.project.name}"/>
	<property name="current.path" value="${project.path}/outmodels/test"/>
	<property name="target.path" value="../../../uml2cs-instantmessenger-default/src"/>
	
	<property name="metamodel.uml2.nsURI" value="http://www.eclipse.org/uml2/2.0.0/UML"/>
	<property name="metamodel.uml2.path" value="/uml2cs-transformations/metamodels/UML2Profiles.ecore"/>
	<property name="profile.accessors.path" value="/uml2cs-transformations/profiles/Accessors.profile.uml"/>
	<property name="model.uml2types.path" value="/uml2cs-transformations/models/PrimitiveTypes.uml"/>
	<property name="model.javatypes.path" value="/uml2cs-transformations/models/JavaTypes.uml"/>
	<property name="model.obstypes.path" value="/uml2cs-transformations/models/Observer.uml"/>

	<property name="model.in.path" value="${project.path}/models/InstantMessengerModel.uml"/>
	<property name="model.profiles.path" value="${current.path}/im-profiles.uml"/>
	<property name="model.accessors.path" value="${current.path}/im-accessors.uml"/>
	<property name="model.observer.path" value="${current.path}/im-observer.uml"/>
	<property name="model.singleton.path" value="${current.path}/im-singleton.uml"/>
	<property name="model.datatypes.path" value="${current.path}/im-datatypes.uml"/>
	<property name="model.obsdatatypes.path" value="${current.path}/obs-datatypes.uml"/>

	<property name="trans.path" value="/uml2cs-transformations"/>
	<property name="trans.uml2copy.path" value="${trans.path}/UML2Copy.atl"/>
	<property name="trans.uml2profilecopy.path" value="${trans.path}/UML2ProfileCopy.asm"/>
	<property name="trans.uml2profiles.path" value="${trans.path}/UML2Profiles.asm"/>
	<property name="trans.uml2accessors.path" value="${trans.path}/UML2Accessors.asm"/>
	<property name="trans.uml2observer.path" value="${trans.path}/UML2Observer.asm"/>
	<property name="trans.uml2singleton.path" value="${trans.path}/UML2Singleton.asm"/>
	<property name="trans.uml2datatypes.path" value="${trans.path}/UML2DataTypes.asm"/>
	<property name="trans.uml2tojava.path" value="${trans.path}/UML2ToJava.atl"/>

	<property name="lib.path" value="${trans.path}/lib"/>
	<property name="lib.java1.path" value="${lib.path}/Java1.asm"/>
	<property name="lib.javamappings.path" value="${lib.path}/JavaMappings.asm"/>
	<property name="lib.strings.path" value="${lib.path}/Strings.asm"/>
	<property name="lib.uml2.path" value="${lib.path}/UML2.asm"/>

	<property name="lib.config.path" value="${current.path}/config.asm"/>

	<target name="loadModels">
		<am3.loadModel modelHandler="EMF" name="UML2" metamodel="MOF" path="${metamodel.uml2.path}"/>
		<am3.loadModel modelHandler="EMF" name="Accessors" metamodel="UML2" path="${profile.accessors.path}"/>
		<am3.loadModel modelHandler="EMF" name="PrimitiveTypes" metamodel="UML2" path="${model.uml2types.path}"/>
		<am3.loadModel modelHandler="EMF" name="JavaTypes" metamodel="UML2" path="${model.javatypes.path}"/>
		<am3.loadModel modelHandler="EMF" name="Observer" metamodel="UML2" path="${model.obstypes.path}"/>
		<am3.loadModel modelHandler="EMF" name="inModel" metamodel="UML2" path="${model.in.path}"/>
	</target>

	<target name="im-profiles" depends="loadModels">
		<am3.atl path="${trans.uml2copy.path}" allowInterModelReferences="true">
			<inmodel name="UML2" model="UML2"/>
			<inmodel name="IN" model="inModel"/>
			<inmodel name="ACCESSORS" model="Accessors"/>
			<outmodel name="OUT" model="im-profiles" metamodel="UML2" path="${model.profiles.path}"/>
			<library name="UML2" path="${lib.uml2.path}"/>
			<superimpose path="${trans.uml2profiles.path}"/>
			<superimpose path="${trans.uml2profilecopy.path}"/>
		</am3.atl>
		<am3.saveModel model="im-profiles" path="${model.profiles.path}"/>
	</target>

	<target name="im-accessors" depends="im-profiles">
		<am3.atl path="${trans.uml2copy.path}" allowInterModelReferences="true">
			<inmodel name="UML2" model="UML2"/>
			<inmodel name="ACCESSORS" model="Accessors"/>
			<inmodel name="UML2TYPES" model="PrimitiveTypes"/>
			<inmodel name="IN" model="im-profiles"/>
			<outmodel name="OUT" model="im-accessors" metamodel="UML2" path="${model.accessors.path}"/>
			<library name="Strings" path="${lib.strings.path}"/>
			<library name="UML2" path="${lib.uml2.path}"/>
			<library name="Java" path="${lib.java1.path}"/>
			<library name="Mappings" path="${lib.javamappings.path}"/>
			<superimpose path="${trans.uml2accessors.path}"/>
			<superimpose path="${trans.uml2profilecopy.path}"/>
		</am3.atl>
		<am3.saveModel model="im-accessors" path="${model.accessors.path}"/>
	</target>

	<target name="im-observer" depends="im-accessors">
		<am3.atl path="${trans.uml2copy.path}" allowInterModelReferences="true">
			<inmodel name="UML2" model="UML2"/>
			<inmodel name="OBSERVER" model="Observer"/>
			<inmodel name="UML2TYPES" model="PrimitiveTypes"/>
			<inmodel name="IN" model="im-accessors"/>
			<outmodel name="OUT" model="im-observer" metamodel="UML2" path="${model.observer.path}"/>
			<library name="Strings" path="${lib.strings.path}"/>
			<library name="UML2" path="${lib.uml2.path}"/>
			<library name="Java" path="${lib.java1.path}"/>
			<library name="Mappings" path="${lib.javamappings.path}"/>
			<superimpose path="${trans.uml2observer.path}"/>
			<superimpose path="${trans.uml2profilecopy.path}"/>
		</am3.atl>
		<am3.saveModel model="im-observer" path="${model.observer.path}"/>
	</target>

	<target name="im-singleton" depends="im-observer">
		<am3.atl path="${trans.uml2copy.path}" allowInterModelReferences="true">
			<inmodel name="UML2" model="UML2"/>
			<inmodel name="IN" model="im-observer"/>
			<outmodel name="OUT" model="im-singleton" metamodel="UML2" path="${model.singleton.path}"/>
			<library name="UML2" path="${lib.uml2.path}"/>
			<library name="Java" path="${lib.java1.path}"/>
			<library name="Mappings" path="${lib.javamappings.path}"/>
			<superimpose path="${trans.uml2singleton.path}"/>
			<superimpose path="${trans.uml2profilecopy.path}"/>
		</am3.atl>
		<am3.saveModel model="im-singleton" path="${model.singleton.path}"/>
	</target>

	<target name="im-datatypes" depends="im-singleton">
		<am3.atl path="${trans.uml2copy.path}" allowInterModelReferences="true">
			<inmodel name="UML2" model="UML2"/>
			<inmodel name="IMPLTYPES" model="JavaTypes"/>
			<inmodel name="IN" model="im-singleton"/>
			<outmodel name="OUT" model="im-datatypes" metamodel="UML2" path="${model.datatypes.path}"/>
			<library name="Strings" path="${lib.strings.path}"/>
			<library name="UML2" path="${lib.uml2.path}"/>
			<library name="Java" path="${lib.java1.path}"/>
			<library name="Mappings" path="${lib.javamappings.path}"/>
			<superimpose path="${trans.uml2datatypes.path}"/>
			<superimpose path="${trans.uml2profilecopy.path}"/>
		</am3.atl>
		<am3.saveModel model="im-datatypes" path="${model.datatypes.path}"/>
	</target>

	<target name="Observer-datatypes" depends="loadModels">
		<am3.atl path="${trans.uml2copy.path}" allowInterModelReferences="true">
			<inmodel name="UML2" model="UML2"/>
			<inmodel name="IMPLTYPES" model="JavaTypes"/>
			<inmodel name="IN" model="Observer"/>
			<outmodel name="OUT" model="obs-datatypes" metamodel="UML2" path="${model.obsdatatypes.path}"/>
			<library name="Strings" path="${lib.strings.path}"/>
			<library name="UML2" path="${lib.uml2.path}"/>
			<library name="Java" path="${lib.java1.path}"/>
			<library name="Mappings" path="${lib.javamappings.path}"/>
			<superimpose path="${trans.uml2datatypes.path}"/>
			<superimpose path="${trans.uml2profilecopy.path}"/>
		</am3.atl>
		<am3.saveModel model="obs-datatypes" path="${model.obsdatatypes.path}"/>
	</target>

	<target name="cleanGeneratedCode">
        <delete>
            <fileset dir="${target.path}"/>
        </delete>
	</target>

	<target name="generateObserver" depends="cleanGeneratedCode,Observer-datatypes">
		<am3.atl path="${trans.uml2tojava.path}" allowInterModelReferences="true">
			<inmodel name="UML2" model="UML2"/>
			<inmodel name="IN" model="obs-datatypes"/>
			<library name="config" path="${lib.config.path}"/>
			<library name="UML2" path="${lib.uml2.path}"/>
		</am3.atl>
	</target>

	<target name="generate" depends="cleanGeneratedCode,im-datatypes">
		<am3.atl path="${trans.uml2tojava.path}" allowInterModelReferences="true">
			<inmodel name="UML2" model="UML2"/>
			<inmodel name="IN" model="im-datatypes"/>
			<library name="config" path="${lib.config.path}"/>
			<library name="UML2" path="${lib.uml2.path}"/>
		</am3.atl>
	</target>

    <target name="all" depends="generateObserver,generate"/>
</project>